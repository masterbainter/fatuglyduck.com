<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lakota: Migration, Expansion & Resilience (1400-1950)</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        earth: {
                            50: '#FAF7F5',
                            100: '#F5F5F0',
                            200: '#E7E5E4',
                            300: '#D6D3D1',
                            400: '#A8A29E',
                            500: '#78716C',
                            600: '#57534E',
                            700: '#44403C',
                            800: '#292524',
                            900: '#1C1917',
                            950: '#0F0E0D'
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Work+Sans:wght@300;400;500;600&display=swap');

        body {
            font-family: 'Work Sans', sans-serif;
        }
        h1, h2, h3, h4 {
            font-family: 'Libre Baskerville', serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 350px;
            max-height: 450px;
            margin-left: auto;
            margin-right: auto;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        /* Custom Scrollbar - Light Mode */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #E7E5E4;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #A8A29E;
            border-radius: 20px;
        }
        /* Custom Scrollbar - Dark Mode */
        .dark .custom-scroll::-webkit-scrollbar-track {
            background: #292524;
        }
        .dark .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #57534E;
        }
        /* Active Tab Styling */
        .active-tab {
            background-color: #78350F;
            color: white;
            border-left: 4px solid #B45309;
        }
        .inactive-tab {
            background-color: transparent;
        }
        /* Theme Toggle Button */
        .theme-toggle {
            transition: transform 0.3s ease;
        }
        .theme-toggle:hover {
            transform: scale(1.1);
        }
    </style>
    <!-- Chosen Palette: "Earth and Plains" - Warm Stone/Beige backgrounds (#F5F5F0), Deep Earth Brown (#78350F) for primary actions, Muted Clay Red (#9F1239) for conflict/alerts, and Sage/Sky accents. -->
    <!-- Application Structure Plan:
        1. Layout: Dashboard-style with a fixed left sidebar (navigation) and a scrollable main content area.
        2. Navigation Strategy: Chronological Eras. This best organizes the complex history of migration and warring.
           - Era 1: Origins & The East (1400-1700)
           - Era 2: The Horse & Expansion (1700-1850) - Focus on warring with other tribes.
           - Era 3: Defense of the Plains (1850-1890) - Focus on US Settler pressure.
           - Era 4: Reservation & Adaptation (1890-1950)
        3. Dashboard Home: A high-level overview visualization (Timeline & Map abstraction).
        4. Interactive Elements:
           - "Conflict Cards": Clickable cards detailing interactions with specific tribes (Crow, Pawnee, etc.).
           - "Territory Chart": Dynamic Area chart showing land control changes.
           - "Economy Shifter": Toggle between "Woodland Economy" and "Buffalo Economy" to see lifestyle impacts.
    -->
    <!-- Visualization & Content Choices:
        1. Goal: Show Expansion/Contraction of Land.
           - Viz: Chart.js Line/Area Chart.
           - Justification: Clearly illustrates the rise in power (1750-1850) and sudden loss (1868-1890).
        2. Goal: Detail Inter-tribal Conflict.
           - Viz: Interactive Grid of Cards (HTML/JS).
           - Interaction: Click to expand details about the specific rival tribe and the outcome.
           - Justification: Text-heavy relationships are best read in cards, not abstract charts.
        3. Goal: Bison Dependence.
           - Viz: Chart.js Dual Axis Line Chart (Bison Population vs Lakota Population).
           - Justification: Shows the correlation between the resource and the people's strength.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="h-screen flex overflow-hidden bg-earth-100 text-earth-800 dark:bg-earth-950 dark:text-earth-200 transition-colors duration-300">

    <!-- Sidebar Navigation -->
    <aside class="w-64 flex-shrink-0 bg-earth-200 dark:bg-earth-900 border-r border-earth-300 dark:border-earth-700 flex flex-col hidden md:flex">
        <div class="p-6 border-b border-earth-300 dark:border-earth-700 flex justify-between items-start">
            <div>
                <h1 class="text-2xl font-bold text-earth-800 dark:text-earth-100">Lakota History</h1>
                <p class="text-xs text-earth-600 dark:text-earth-400 mt-1 uppercase tracking-widest">1400 â€” 1950</p>
            </div>
            <!-- Theme Toggle -->
            <button onclick="toggleTheme()" class="theme-toggle p-2 rounded-full bg-earth-300 dark:bg-earth-700 hover:bg-earth-400 dark:hover:bg-earth-600 transition-colors" title="Toggle dark/light mode">
                <span class="dark:hidden text-amber-700">â˜€</span>
                <span class="hidden dark:inline text-amber-300">â˜¾</span>
            </button>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1" id="nav-list">
                <!-- Nav items generated by JS -->
            </ul>
        </nav>
        <div class="p-4 bg-earth-300 dark:bg-earth-800 text-xs text-earth-600 dark:text-earth-400">
            <p>Interactive Source Report</p>
            <p class="mt-1">Generated for historical analysis.</p>
        </div>
    </aside>

    <!-- Mobile Header -->
    <div class="md:hidden fixed top-0 w-full bg-earth-200 dark:bg-earth-900 z-50 border-b border-earth-300 dark:border-earth-700 flex justify-between items-center p-4 transition-colors duration-300">
        <h1 class="text-lg font-bold text-earth-800 dark:text-earth-100">Lakota History</h1>
        <div class="flex items-center gap-3">
            <button onclick="toggleTheme()" class="theme-toggle p-2 rounded-full bg-earth-300 dark:bg-earth-700" title="Toggle theme">
                <span class="dark:hidden text-amber-700">â˜€</span>
                <span class="hidden dark:inline text-amber-300">â˜¾</span>
            </button>
            <button id="mobile-menu-btn" class="text-earth-800 dark:text-earth-100 focus:outline-none">
                â˜° Menu
            </button>
        </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-earth-900 bg-opacity-95 z-40 hidden flex flex-col justify-center items-center">
        <button id="close-menu-btn" class="absolute top-4 right-4 text-earth-100 text-xl">âœ• Close</button>
        <nav class="text-center">
            <ul class="space-y-6 text-earth-100 text-lg" id="mobile-nav-list">
                <!-- Mobile Nav Items -->
            </ul>
        </nav>
    </div>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto bg-earth-100 dark:bg-earth-950 relative pt-16 md:pt-0 transition-colors duration-300" id="main-content">
        <!-- Content injected here via JS -->
    </main>

<script>
    // --- Data Store ---
    const appData = {
        currentTab: 'overview',
        tabs: [
            { id: 'overview', label: 'Overview: The Great Expansion', icon: 'â—Ž' },
            { id: 'origins', label: '1400-1700: Woodland Roots', icon: 'â—ˆ' },
            { id: 'expansion', label: '1700-1850: Lords of the Plains', icon: 'âš”' },
            { id: 'settlers', label: '1850-1890: Defense & Treaty', icon: 'âš–' },
            { id: 'reservation', label: '1890-1950: The Reservation Era', icon: 'â—¬' },
            { id: 'sources', label: 'Sources & References', icon: 'ðŸ“š' }
        ],
        content: {
            overview: {
                title: "The Lakota: A Journey West",
                intro: "The history of the Lakota is defined by movement. Starting as woodland harvesters in the Great Lakes region, they migrated west, adopted the horse, and transformed into the dominant military and political power of the Northern Plains before facing the expansion of the United States. This dashboard explores their migration, their wars for territory with other tribes, and their resilience against settler encroachment.",
                charts: [
                    {
                        id: 'territoryChart',
                        type: 'line',
                        title: 'Estimated Territory Control (Square Miles)',
                        desc: 'The rapid expansion during the Horse Age followed by the sharp decline during the Treaty Era.',
                        data: {
                            labels: ['1600', '1700', '1775', '1850', '1868', '1889', '1950'],
                            datasets: [{
                                label: 'Territory Size (Approx. Sq. Miles)',
                                data: [10000, 25000, 60000, 140000, 60000, 25000, 5000], // Rough estimates for visualization
                                borderColor: '#78350F',
                                backgroundColor: 'rgba(120, 53, 15, 0.1)',
                                fill: true,
                                tension: 0.3
                            }]
                        }
                    }
                ],
                stats: [
                    { label: 'Peak Territory', value: '~140,000', sub: 'sq miles (c. 1850)' },
                    { label: 'Key Animal', value: 'Bison', sub: 'Tatanka' },
                    { label: 'Migration Direction', value: 'West', sub: 'Mille Lacs to Black Hills' }
                ]
            },
            origins: {
                title: "1400-1700: Woodland Roots & Migration",
                intro: "Before they were the 'Sioux' of the plains, the Lakota (Teton) lived in the woodlands of present-day Minnesota. They were harvesters of wild rice, fishermen, and deer hunters. Pressure from the Ojibwe (Chippewa) to the east, who acquired French firearms earlier, coupled with the lure of the bison herds, pushed the Lakota westward toward the Missouri River.",
                details: [
                    {
                        title: "The Push Factors",
                        text: "In the mid-1600s, the French fur trade supplied the Ojibwe/Cree with muskets. The Lakota, armed primarily with bows and clubs, found themselves at a disadvantage in the woodlands. This technological imbalance was a primary driver for the westward migration."
                    },
                    {
                        title: "Seven Council Fires (Oceti Sakowin)",
                        text: "The political structure was forming. The Teton (Lakota) moved furthest west, while the Dakota (Santee) remained in Minnesota and the Nakota (Yankton/Yanktonai) bridged the gap."
                    }
                ],
                chart: {
                    id: 'migrationMap',
                    type: 'scatter',
                    title: 'The Westward Drift (Approximate Center of Population)',
                    desc: 'Tracking the longitudinal center of the Lakota people over three centuries.',
                    data: {
                        datasets: [{
                            label: 'Population Center (Longitude)',
                            data: [
                                {x: 1600, y: -93.5}, // Mille Lacs
                                {x: 1650, y: -94.5},
                                {x: 1700, y: -98.0}, // Approaching Missouri
                                {x: 1750, y: -100.5}, // Cross Missouri
                                {x: 1776, y: -103.5}  // Black Hills
                            ],
                            backgroundColor: '#0EA5E9',
                            borderColor: '#0284C7',
                            pointRadius: 8
                        }]
                    }
                }
            },
            expansion: {
                title: "1700-1850: The Horse Culture & Tribal Wars",
                intro: "This is the 'Golden Age' of Lakota power. Acquiring horses around 1700 (from trade networks originating in the Southwest), they became fully nomadic buffalo hunters. This new mobility allowed them to project power over vast distances. They waged war on sedentary river tribes and rival nomads to secure the best hunting grounds, particularly the Powder River Country and the Black Hills.",
                rivals: [
                    { name: 'The Kiowa', status: 'Displaced', desc: 'Inhabited the Black Hills until approx. 1776. The Lakota pushed them south into the Southern Plains.', color: 'bg-red-100 border-red-300' },
                    { name: 'The Crow (ApsÃ¡alooke)', status: 'Main Rival', desc: 'Bitter enemies. They contested the rich hunting grounds of the Powder River. The Lakota gradually pushed the Crow westward toward the mountains.', color: 'bg-orange-100 border-orange-300' },
                    { name: 'The Pawnee', status: 'Constant Raiding', desc: 'Living in earth lodges in Nebraska, the Pawnee were frequent targets for Lakota horse raids and war parties.', color: 'bg-yellow-100 border-yellow-300' },
                    { name: 'Arikara/Mandan', status: 'Dominated', desc: 'Sedentary farming tribes along the Missouri. Decimated by smallpox, they were easily dominated by the expanding Lakota.', color: 'bg-stone-200 border-stone-400' }
                ],
                chart: {
                    id: 'buffaloChart',
                    type: 'bar',
                    title: 'The Resource War: Horse Power vs. Bison Supply',
                    desc: 'As Lakota Horse ownership increased, their ability to harvest Bison grew, leading to population booms.',
                    data: {
                        labels: ['1700', '1750', '1800', '1850'],
                        datasets: [
                            {
                                label: 'Est. Horses per Family',
                                data: [0.5, 3, 5, 8],
                                type: 'line',
                                borderColor: '#B45309',
                                yAxisID: 'y1'
                            },
                            {
                                label: 'Lakota Population (Thousands)',
                                data: [8, 12, 15, 25],
                                backgroundColor: '#57534E',
                                yAxisID: 'y'
                            }
                        ]
                    }
                }
            },
            settlers: {
                title: "1850-1890: The Wars for Defense",
                intro: "By the 1840s, the threat changed from rival tribes to the flooding tide of American settlers on the Oregon Trail. The US Army built forts to protect migrants, violating Lakota sovereignty. This era is defined by broken treaties, the destruction of the buffalo herds (sanctioned by the government to starve the tribes), and total war.",
                timeline: [
                    { year: '1851', event: 'First Fort Laramie Treaty', desc: 'Attempted to define tribal boundaries. Lakota territory recognized, but safe passage for settlers required.' },
                    { year: '1854', event: 'Grattan Fight', desc: 'A dispute over a cow leads to the destruction of a US command. The wars begin in earnest.' },
                    { year: '1866', event: 'Red Cloud\'s War', desc: 'Lakota victory. They force the US to burn their forts on the Bozeman Trail.' },
                    { year: '1868', event: 'Second Fort Laramie Treaty', desc: 'Created the Great Sioux Reservation, including the Black Hills.' },
                    { year: '1874', event: 'Gold in Black Hills', desc: 'Custer\'s expedition confirms gold. Miners flood in. US Government illegally seizes the Hills.' },
                    { year: '1876', event: 'Battle of Little Bighorn', desc: 'Combined Lakota/Cheyenne force destroys Custer\'s 7th Cavalry. A tactical victory, but strategic defeat as US pressure redoubles.' },
                    { year: '1890', event: 'Wounded Knee Massacre', desc: 'The killing of ~300 Minneconjou Lakota. Marks the end of armed resistance.' }
                ],
                chart: {
                    id: 'bisonDecline',
                    type: 'line',
                    title: 'The Destruction of the Buffalo (North American Herd)',
                    desc: 'The deliberate eradication of the Bison destroyed the Lakota economic base.',
                    data: {
                        labels: ['1800', '1850', '1870', '1880', '1890', '1900'],
                        datasets: [{
                            label: 'Bison Population (Millions)',
                            data: [30, 20, 10, 0.5, 0.001, 0.0003],
                            borderColor: '#9F1239',
                            backgroundColor: 'rgba(159, 18, 57, 0.1)',
                            fill: true
                        }]
                    }
                }
            },
            reservation: {
                title: "1890-1950: The Reservation Era",
                intro: "Following Wounded Knee, the Lakota were confined to reservations. The goal of the US government shifted to assimilation. The Great Sioux Reservation was broken up into smaller units (Pine Ridge, Rosebud, Cheyenne River, etc.) to open 'surplus' land to white homesteaders. This era saw the suppression of language and spirituality, but also the survival and adaptation of the culture.",
                policies: [
                    { name: 'Dawes Act (1887)', impact: 'Privatized communal land. Resulted in massive land loss as "surplus" land was sold to non-Natives.' },
                    { name: 'Boarding Schools', impact: 'Children were taken to schools like Carlisle to "Kill the Indian, Save the Man." Language was forbidden.' },
                    { name: 'Indian Reorganization Act (1934)', impact: 'Ended the allotment policy of the Dawes Act. Encouraged tribal self-government, though on a Western model.' }
                ],
                chart: {
                    id: 'landBreakup',
                    type: 'doughnut',
                    title: 'Land Status post-Dawes Act (c. 1920)',
                    desc: 'How the reservation land was fragmented.',
                    data: {
                        labels: ['Tribally Owned', 'Allotted to Individuals', 'Sold to Non-Natives ("Surplus")'],
                        datasets: [{
                            data: [20, 40, 40], // Representative rough percentages for visual impact
                            backgroundColor: ['#78350F', '#D97706', '#E5E7EB']
                        }]
                    }
                }
            },
            sources: {
                title: "Sources & References",
                intro: "This historical overview draws from scholarly works, primary sources, and archival materials. The following sources were consulted in the preparation of this content.",
                categories: [
                    {
                        name: "Primary Academic Sources",
                        sources: [
                            { author: "Ostler, Jeffrey", title: "The Lakotas and the Black Hills: The Struggle for Sacred Ground", publisher: "Viking Press", year: "2010", note: "Definitive account of Lakota claims to the Black Hills and treaty violations." },
                            { author: "Utley, Robert M.", title: "The Lance and the Shield: The Life and Times of Sitting Bull", publisher: "Henry Holt and Company", year: "1993", note: "Biography providing context on Lakota leadership and resistance." },
                            { author: "DeMallie, Raymond J.", title: "The Sixth Grandfather: Black Elk's Teachings Given to John G. Neihardt", publisher: "University of Nebraska Press", year: "1984", note: "Primary source material on Lakota spirituality and oral history." },
                            { author: "White, Richard", title: "The Roots of Dependency: Subsistence, Environment, and Social Change among the Choctaws, Pawnees, and Navajos", publisher: "University of Nebraska Press", year: "1983", note: "Comparative analysis of Plains Indian economies and adaptations." },
                            { author: "Calloway, Colin G.", title: "One Vast Winter Count: The Native American West before Lewis and Clark", publisher: "University of Nebraska Press", year: "2003", note: "Pre-contact and early contact period history of Plains tribes." }
                        ]
                    },
                    {
                        name: "General Histories",
                        sources: [
                            { author: "Brown, Dee", title: "Bury My Heart at Wounded Knee: An Indian History of the American West", publisher: "Holt, Rinehart & Winston", year: "1970", note: "Influential narrative history of Native American displacement." },
                            { author: "Olson, James C.", title: "Red Cloud and the Sioux Problem", publisher: "University of Nebraska Press", year: "1965", note: "Detailed account of Red Cloud's War and treaty negotiations." },
                            { author: "Hyde, George E.", title: "Red Cloud's Folk: A History of the Oglala Sioux Indians", publisher: "University of Oklahoma Press", year: "1937", note: "Early ethnographic history of the Oglala band." },
                            { author: "Hassrick, Royal B.", title: "The Sioux: Life and Customs of a Warrior Society", publisher: "University of Oklahoma Press", year: "1964", note: "Comprehensive study of Lakota social organization and culture." }
                        ]
                    },
                    {
                        name: "Government & Archival Sources",
                        sources: [
                            { author: "National Archives", title: "Records of the Bureau of Indian Affairs (Record Group 75)", publisher: "U.S. National Archives", year: "Various", note: "Treaty documents, agency records, and correspondence." },
                            { author: "Kappler, Charles J. (ed.)", title: "Indian Affairs: Laws and Treaties", publisher: "Government Printing Office", year: "1904", note: "Complete texts of Fort Laramie Treaties (1851, 1868) and related agreements." },
                            { author: "U.S. Congress", title: "Report on the Condition of the Indian Tribes", publisher: "Government Printing Office", year: "1867", note: "Congressional investigation into Indian policy and conditions." }
                        ]
                    },
                    {
                        name: "Population & Environmental Data",
                        sources: [
                            { author: "Isenberg, Andrew C.", title: "The Destruction of the Bison: An Environmental History, 1750-1920", publisher: "Cambridge University Press", year: "2000", note: "Source for bison population estimates and decline data." },
                            { author: "Thornton, Russell", title: "American Indian Holocaust and Survival: A Population History Since 1492", publisher: "University of Oklahoma Press", year: "1987", note: "Demographic data on Native American population changes." },
                            { author: "HÃ¤mÃ¤lÃ¤inen, Pekka", title: "Lakota America: A New History of Indigenous Power", publisher: "Yale University Press", year: "2019", note: "Recent scholarship on Lakota territorial expansion and political power." }
                        ]
                    }
                ],
                disclaimer: "Note: Population figures, territorial estimates, and timeline dates represent scholarly consensus where available. Some figures are approximations based on historical records and archaeological evidence. The Lakota people maintain their own oral histories and interpretations of these events."
            }
        }
    };

    // --- Core Logic ---

    // Init
    document.addEventListener('DOMContentLoaded', () => {
        renderNav();
        loadTab(appData.currentTab);
        setupMobileMenu();
    });

    // Navigation Renderer
    function renderNav() {
        const navList = document.getElementById('nav-list');
        const mobileNavList = document.getElementById('mobile-nav-list');
        
        const html = appData.tabs.map(tab => `
            <li>
                <button 
                    onclick="loadTab('${tab.id}')"
                    class="w-full text-left px-6 py-3 font-medium transition-colors duration-200 flex items-center gap-3 ${appData.currentTab === tab.id ? 'active-tab' : 'inactive-tab text-earth-600 dark:text-earth-400 hover:bg-earth-300 dark:hover:bg-earth-800'}"
                    id="nav-btn-${tab.id}"
                >
                    <span class="text-lg">${tab.icon}</span>
                    <span>${tab.label}</span>
                </button>
            </li>
        `).join('');

        navList.innerHTML = html;
        mobileNavList.innerHTML = html.replace(/text-left/g, 'text-center').replace(/px-6/g, 'px-2');
    }

    // Tab Loader
    function loadTab(tabId) {
        appData.currentTab = tabId;
        renderNav(); // Update active states
        const content = appData.content[tabId];
        const main = document.getElementById('main-content');
        
        // Scroll to top
        main.scrollTop = 0;

        // Content Templates based on ID
        let innerHTML = '';

        // Header Section
        innerHTML += `
            <div class="max-w-5xl mx-auto p-6 md:p-10 fade-in">
                <header class="mb-8 border-b border-earth-300 dark:border-earth-700 pb-6">
                    <h2 class="text-3xl md:text-4xl font-bold text-earth-900 dark:text-earth-50 mb-4 tracking-tight">${content.title}</h2>
                    <p class="text-lg text-earth-700 dark:text-earth-300 leading-relaxed max-w-3xl">${content.intro}</p>
                </header>
        `;

        // Specific View Logic
        if (tabId === 'overview') {
            innerHTML += renderOverview(content);
        } else if (tabId === 'origins') {
            innerHTML += renderOrigins(content);
        } else if (tabId === 'expansion') {
            innerHTML += renderExpansion(content);
        } else if (tabId === 'settlers') {
            innerHTML += renderSettlers(content);
        } else if (tabId === 'reservation') {
            innerHTML += renderReservation(content);
        } else if (tabId === 'sources') {
            innerHTML += renderSources(content);
        }

        innerHTML += `</div>`; // Close container
        main.innerHTML = innerHTML;

        // Post-render: Initialize Charts
        if (content.charts) {
            content.charts.forEach(c => initChart(c));
        }
        if (content.chart) {
            initChart(content.chart);
        }

        // Close mobile menu if open
        document.getElementById('mobile-menu').classList.add('hidden');
    }

    // --- Render Helpers ---

    function renderOverview(content) {
        return `
            <figure class="mb-10 rounded-lg overflow-hidden shadow-lg">
                <img
                    src="lakota-history-01.jpg"
                    alt="Hide painting depicting Lakota migration westward - a caravan of people on horseback traveling from woodland to plains under a rainbow"
                    class="w-full h-auto"
                    loading="lazy"
                >
                <figcaption class="bg-[#78350F] text-amber-100 px-4 py-3 text-sm italic text-center">
                    Hide painting: The westward migration of the Lakota from the Great Lakes woodlands to the Northern Plains
                </figcaption>
            </figure>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                ${content.stats.map(stat => `
                    <div class="bg-white dark:bg-earth-800 p-6 rounded shadow-sm border border-earth-200 dark:border-earth-700 text-center">
                        <div class="text-earth-500 dark:text-earth-400 text-sm uppercase tracking-wide mb-1">${stat.label}</div>
                        <div class="text-3xl font-bold text-[#78350F] dark:text-amber-500">${stat.value}</div>
                        <div class="text-xs text-earth-400 dark:text-earth-500 mt-1">${stat.sub}</div>
                    </div>
                `).join('')}
            </div>

            <div class="bg-white dark:bg-earth-800 p-6 rounded shadow-sm border border-earth-200 dark:border-earth-700 mb-8">
                <h3 class="text-xl font-bold mb-2 dark:text-earth-100">${content.charts[0].title}</h3>
                <p class="text-sm text-earth-500 dark:text-earth-400 mb-6">${content.charts[0].desc}</p>
                <div class="chart-container">
                    <canvas id="${content.charts[0].id}"></canvas>
                </div>
            </div>

            <div class="bg-earth-200 dark:bg-earth-800 p-6 rounded border-l-4 border-[#78350F]">
                <h3 class="font-bold text-lg mb-2 dark:text-earth-100">Analysis: Migration as Survival</h3>
                <p class="text-earth-700 dark:text-earth-300">The Lakota story is one of rapid adaptation. Within 150 years, they completely reinvented their economy (from gathering to hunting), their military tactics (foot to horse), and their geographical home. This flexibility was their greatest strength until the total resource destruction of the 1880s.</p>
            </div>
        `;
    }

    function renderOrigins(content) {
        return `
            <figure class="mb-10 rounded-lg overflow-hidden shadow-lg">
                <img
                    src="lakota-history-03.jpg"
                    alt="Hide painting showing mounted warriors in battle - depicting the inter-tribal conflicts that shaped Lakota migration"
                    class="w-full h-auto"
                    loading="lazy"
                >
                <figcaption class="bg-[#78350F] text-amber-100 px-4 py-3 text-sm italic text-center">
                    Hide painting: Warfare between tribes was a driving force in the Lakota's westward movement
                </figcaption>
            </figure>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <div class="bg-white dark:bg-earth-800 p-6 rounded shadow-sm border border-earth-200 dark:border-earth-700 mb-6">
                        <h3 class="text-xl font-bold mb-2 dark:text-earth-100">${content.chart.title}</h3>
                        <p class="text-sm text-earth-500 dark:text-earth-400 mb-6">${content.chart.desc}</p>
                        <div class="chart-container">
                            <canvas id="${content.chart.id}"></canvas>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    ${content.details.map(d => `
                        <div class="bg-white dark:bg-earth-800 p-6 rounded shadow-sm border-l-4 border-sky-600 dark:border-sky-500">
                            <h3 class="text-lg font-bold mb-2 text-earth-900 dark:text-earth-100">${d.title}</h3>
                            <p class="text-earth-700 dark:text-earth-300 leading-relaxed">${d.text}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    function renderExpansion(content) {
        return `
            <figure class="mb-10 rounded-lg overflow-hidden shadow-lg">
                <img
                    src="lakota-history-02.jpg"
                    alt="Hide painting of a Lakota warrior on horseback hunting bison with a spear - representing the horse culture and buffalo economy"
                    class="w-full h-auto"
                    loading="lazy"
                >
                <figcaption class="bg-[#78350F] text-amber-100 px-4 py-3 text-sm italic text-center">
                    Hide painting: A mounted Lakota warrior hunting bison â€” the horse transformed the Lakota into the dominant power of the Northern Plains
                </figcaption>
            </figure>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white dark:bg-earth-800 p-6 rounded shadow-sm border border-earth-200 dark:border-earth-700">
                     <h3 class="text-xl font-bold mb-2 dark:text-earth-100">${content.chart.title}</h3>
                    <p class="text-sm text-earth-500 dark:text-earth-400 mb-6">${content.chart.desc}</p>
                    <div class="chart-container">
                        <canvas id="${content.chart.id}"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4 dark:text-earth-100">The Rivalry Matrix</h3>
                    <div class="grid grid-cols-1 gap-4 h-full overflow-y-auto custom-scroll max-h-[450px]">
                        ${content.rivals.map(r => `
                            <div class="p-4 rounded border ${r.color} dark:bg-earth-800 dark:border-earth-600 transition hover:shadow-md cursor-default">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-bold text-lg dark:text-earth-100">${r.name}</h4>
                                    <span class="text-xs font-bold uppercase tracking-wider px-2 py-1 bg-white dark:bg-earth-700 bg-opacity-50 rounded dark:text-earth-200">${r.status}</span>
                                </div>
                                <p class="text-sm text-earth-800 dark:text-earth-300">${r.desc}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="p-4 bg-earth-200 dark:bg-earth-800 rounded text-center text-sm text-earth-600 dark:text-earth-400 italic">
                "The Lakota did not merely wander onto the plains; they conquered them."
            </div>
        `;
    }

    function renderSettlers(content) {
        return `
            <figure class="mb-10 rounded-lg overflow-hidden shadow-lg">
                <img
                    src="lakota-history-04.jpg"
                    alt="Hide painting showing a steam locomotive on railroad tracks with piles of bison skulls beside the rails - symbolizing the deliberate destruction of the buffalo herds"
                    class="w-full h-auto"
                    loading="lazy"
                >
                <figcaption class="bg-[#78350F] text-amber-100 px-4 py-3 text-sm italic text-center">
                    Hide painting: The railroad and the deliberate destruction of the buffalo â€” a strategy to starve the Plains tribes into submission
                </figcaption>
            </figure>

            <div class="mb-10">
                <h3 class="text-xl font-bold mb-6 dark:text-earth-100">Timeline of Conflict</h3>
                <div class="relative border-l-2 border-earth-300 dark:border-earth-600 ml-4 space-y-8">
                    ${content.timeline.map(t => `
                        <div class="relative pl-8">
                            <div class="absolute -left-[9px] top-1 w-4 h-4 rounded-full bg-[#9F1239] border-2 border-white dark:border-earth-900"></div>
                            <div class="font-bold text-[#9F1239] dark:text-rose-400">${t.year}</div>
                            <h4 class="font-bold text-earth-900 dark:text-earth-100">${t.event}</h4>
                            <p class="text-earth-600 dark:text-earth-400 mt-1">${t.desc}</p>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div class="bg-white dark:bg-earth-800 p-6 rounded shadow-sm border border-earth-200 dark:border-earth-700">
                <h3 class="text-xl font-bold mb-2 dark:text-earth-100">${content.chart.title}</h3>
                <div class="chart-container">
                    <canvas id="${content.chart.id}"></canvas>
                </div>
            </div>
        `;
    }

    function renderReservation(content) {
        return `
            <figure class="mb-10 rounded-lg overflow-hidden shadow-lg">
                <img
                    src="lakota-history-05.jpg"
                    alt="Hide painting depicting reservation life - log cabins within fenced areas, Native people in traditional clothing, and a church or school building in the distance on the sparse plains"
                    class="w-full h-auto"
                    loading="lazy"
                >
                <figcaption class="bg-[#78350F] text-amber-100 px-4 py-3 text-sm italic text-center">
                    Hide painting: Reservation life â€” confinement to small plots, forced housing changes, and the church/school representing assimilation policies
                </figcaption>
            </figure>

            <div class="flex flex-col-reverse lg:flex-row gap-8">
                <div class="flex-1 space-y-4">
                    <h3 class="text-xl font-bold mb-4 dark:text-earth-100">Impact of Federal Policy</h3>
                    ${content.policies.map(p => `
                        <div class="p-5 bg-white dark:bg-earth-800 border border-earth-200 dark:border-earth-700 rounded shadow-sm">
                            <h4 class="font-bold text-earth-800 dark:text-earth-100 mb-1">${p.name}</h4>
                            <p class="text-earth-600 dark:text-earth-400">${p.impact}</p>
                        </div>
                    `).join('')}
                </div>
                <div class="flex-1">
                    <div class="bg-white dark:bg-earth-800 p-6 rounded shadow-sm border border-earth-200 dark:border-earth-700 h-full flex flex-col items-center justify-center">
                         <h3 class="text-xl font-bold mb-2 text-center dark:text-earth-100">${content.chart.title}</h3>
                         <p class="text-sm text-earth-500 dark:text-earth-400 mb-6 text-center">${content.chart.desc}</p>
                        <div class="chart-container">
                            <canvas id="${content.chart.id}"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderSources(content) {
        return `
            <div class="space-y-8">
                ${content.categories.map(cat => `
                    <div class="bg-white dark:bg-earth-800 p-6 rounded-lg shadow-sm border border-earth-200 dark:border-earth-700">
                        <h3 class="text-xl font-bold mb-4 text-earth-900 dark:text-earth-100 border-b border-earth-200 dark:border-earth-700 pb-2">${cat.name}</h3>
                        <ul class="space-y-4">
                            ${cat.sources.map(src => `
                                <li class="pl-4 border-l-2 border-[#78350F]">
                                    <p class="font-medium text-earth-800 dark:text-earth-200">
                                        ${src.author}. <em class="text-[#78350F] dark:text-amber-500">${src.title}</em>.
                                        ${src.publisher}, ${src.year}.
                                    </p>
                                    <p class="text-sm text-earth-600 dark:text-earth-400 mt-1">${src.note}</p>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `).join('')}

                <div class="bg-earth-200 dark:bg-earth-800 p-6 rounded-lg border-l-4 border-amber-600">
                    <h4 class="font-bold text-earth-800 dark:text-earth-200 mb-2">Disclaimer</h4>
                    <p class="text-earth-700 dark:text-earth-300 text-sm">${content.disclaimer}</p>
                </div>

                <div class="bg-white dark:bg-earth-800 p-6 rounded-lg shadow-sm border border-earth-200 dark:border-earth-700">
                    <h3 class="text-xl font-bold mb-4 text-earth-900 dark:text-earth-100">Further Reading</h3>
                    <p class="text-earth-700 dark:text-earth-300 mb-4">For those interested in learning more about Lakota history and culture, the following institutions maintain extensive collections:</p>
                    <ul class="space-y-2 text-earth-600 dark:text-earth-400">
                        <li>â€¢ <strong>Akta Lakota Museum & Cultural Center</strong> - Chamberlain, South Dakota</li>
                        <li>â€¢ <strong>Oglala Lakota College Historical Center</strong> - Kyle, South Dakota</li>
                        <li>â€¢ <strong>National Museum of the American Indian</strong> - Smithsonian Institution</li>
                        <li>â€¢ <strong>Nebraska State Historical Society</strong> - Lincoln, Nebraska</li>
                        <li>â€¢ <strong>South Dakota State Historical Society</strong> - Pierre, South Dakota</li>
                    </ul>
                </div>
            </div>
        `;
    }

    // --- Chart Logic ---
    let activeCharts = {};

    function isDarkMode() {
        return document.documentElement.classList.contains('dark');
    }

    function getChartColors() {
        const dark = isDarkMode();
        return {
            text: dark ? '#E7E5E4' : '#292524',
            grid: dark ? '#44403C' : '#E7E5E4',
            tooltip: dark ? '#1C1917' : '#292524',
            legendText: dark ? '#D6D3D1' : '#57534E'
        };
    }

    function initChart(config) {
        const ctx = document.getElementById(config.id).getContext('2d');
        const colors = getChartColors();

        // Destroy existing if ID matches
        if (activeCharts[config.id]) {
            activeCharts[config.id].destroy();
        }

        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        font: { family: "'Work Sans', sans-serif" },
                        color: colors.legendText
                    }
                },
                tooltip: {
                    backgroundColor: colors.tooltip,
                    titleFont: { family: "'Work Sans', sans-serif" },
                    bodyFont: { family: "'Work Sans', sans-serif" }
                }
            },
            scales: {
                x: {
                    ticks: { color: colors.text },
                    grid: { color: colors.grid }
                },
                y: {
                    ticks: { color: colors.text },
                    grid: { color: colors.grid }
                }
            }
        };

        let specificOptions = {};

        if (config.type === 'scatter') {
            specificOptions = {
                scales: {
                    x: {
                        title: { display: true, text: 'Year', color: colors.text },
                        min: 1550,
                        max: 1800,
                        ticks: { color: colors.text },
                        grid: { color: colors.grid }
                    },
                    y: {
                        title: { display: true, text: 'Longitude (West ->)', color: colors.text },
                        reverse: true,
                        ticks: { color: colors.text },
                        grid: { color: colors.grid }
                    }
                }
            };
        }

        if (config.id === 'buffaloChart') {
            specificOptions = {
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'Lakota Pop (Thousands)', color: colors.text },
                        ticks: { color: colors.text },
                        grid: { color: colors.grid }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: 'Horses per Family', color: colors.text },
                        ticks: { color: colors.text },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        }

        if (config.type === 'doughnut') {
            // Doughnut charts don't use scales
            delete commonOptions.scales;
        }

        activeCharts[config.id] = new Chart(ctx, {
            type: config.type,
            data: config.data,
            options: { ...commonOptions, ...specificOptions }
        });
    }

    // Mobile Menu
    function setupMobileMenu() {
        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        const close = document.getElementById('close-menu-btn');

        btn.addEventListener('click', () => {
            menu.classList.remove('hidden');
        });
        close.addEventListener('click', () => {
            menu.classList.add('hidden');
        });
    }

    // Theme Toggle
    function toggleTheme() {
        const html = document.documentElement;
        const isDark = html.classList.contains('dark');

        if (isDark) {
            html.classList.remove('dark');
            html.classList.add('light');
            localStorage.setItem('theme', 'light');
        } else {
            html.classList.remove('light');
            html.classList.add('dark');
            localStorage.setItem('theme', 'dark');
        }

        // Reload current tab to reinitialize charts with new colors
        loadTab(appData.currentTab);
    }

    // Initialize theme from localStorage or system preference
    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        const html = document.documentElement;

        if (savedTheme) {
            html.classList.remove('light', 'dark');
            html.classList.add(savedTheme);
        } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            html.classList.remove('light');
            html.classList.add('dark');
        }
    }

    // Call initTheme immediately
    initTheme();

</script>
</body>
</html>
